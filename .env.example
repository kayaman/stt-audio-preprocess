# =============================================================================
# Audio Preprocessing Service - Environment Configuration
# =============================================================================
# Copy this file to .env and configure for your environment
# =============================================================================

# -----------------------------------------------------------------------------
# Azure Storage
# -----------------------------------------------------------------------------
# Option 1: Connection string (for local dev or shared key auth)
AZURE_STORAGE_CONNECTION_STRING=DefaultEndpointsProtocol=https;AccountName=your_account;AccountKey=your_key;EndpointSuffix=core.windows.net

# Option 2: Storage account name (for managed identity in Azure)
# AZURE_STORAGE_ACCOUNT_NAME=staudiopreprocess

# Containers
AZURE_CONTAINER_INPUT=audio-input
AZURE_CONTAINER_OUTPUT=audio-output
AZURE_FOLDER_INPUT=incoming
AZURE_FOLDER_OUTPUT=processed
AZURE_QUEUE_NAME=audio-processing-queue

# Delete source files after processing
AZURE_DELETE_SOURCE=true

# -----------------------------------------------------------------------------
# Processing Mode
# -----------------------------------------------------------------------------
# queue    - Listen to Storage Queue (recommended for production)
# polling  - Periodically scan input container (simpler setup)
# manual   - API-only, no background processing (for testing)
PROCESSING_MODE=queue
POLLING_INTERVAL_SECONDS=10

# -----------------------------------------------------------------------------
# Audio Output Settings (Whisper-optimized defaults)
# -----------------------------------------------------------------------------
AUDIO_TARGET_SAMPLE_RATE=16000
AUDIO_TARGET_CHANNELS=1
AUDIO_TARGET_BIT_DEPTH=16

# -----------------------------------------------------------------------------
# Voice Activity Detection (Silero VAD)
# -----------------------------------------------------------------------------
VAD_ENABLED=true
VAD_THRESHOLD=0.5
VAD_MIN_SPEECH_DURATION_MS=250
VAD_MIN_SILENCE_DURATION_MS=100
VAD_SPEECH_PAD_MS=30
VAD_WINDOW_SIZE_SAMPLES=512

# -----------------------------------------------------------------------------
# Silence Compression
# -----------------------------------------------------------------------------
SILENCE_ENABLED=true
SILENCE_MAX_GAP_MS=600
SILENCE_KEEP_MS=150

# -----------------------------------------------------------------------------
# Noise Reduction (Spectral Gating)
# -----------------------------------------------------------------------------
# Warning: CPU-intensive, only enable for noisy audio
NOISE_ENABLED=false
NOISE_STATIONARY=true
NOISE_PROP_DECREASE=1.0
NOISE_N_FFT=512

# -----------------------------------------------------------------------------
# Normalization
# -----------------------------------------------------------------------------
NORMALIZE_ENABLED=true
NORMALIZE_TARGET_DBFS=-20.0

# -----------------------------------------------------------------------------
# Processing Limits
# -----------------------------------------------------------------------------
PROCESSING_MAX_FILE_SIZE_MB=500
PROCESSING_TIMEOUT_SECONDS=600
PROCESSING_MAX_CONCURRENT=4
PROCESSING_RETRY_ATTEMPTS=3

# -----------------------------------------------------------------------------
# Server
# -----------------------------------------------------------------------------
SERVER_HOST=0.0.0.0
SERVER_PORT=8080
SERVER_WORKERS=1
SERVER_LOG_LEVEL=info

# -----------------------------------------------------------------------------
# Application
# -----------------------------------------------------------------------------
APP_NAME=audio-preprocess
APP_VERSION=2.0.0
ENVIRONMENT=development
DEBUG=false
