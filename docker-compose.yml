# =============================================================================
# Docker Compose for Local Development
# =============================================================================
# 
# Usage:
#   docker compose up --build
#
# =============================================================================

services:
  # ---------------------------------------------------------------------------
  # Audio Preprocessing Service
  # ---------------------------------------------------------------------------
  audio-preprocess:
    build:
      context: .
      dockerfile: Dockerfile
      target: production
    container_name: audio-preprocess
    ports:
      - "8080:8080"
    environment:
      # Audio settings
      - AUDIO_TARGET_SAMPLE_RATE=16000
      - AUDIO_TARGET_CHANNELS=1
      
      # VAD
      - VAD_ENABLED=true
      - VAD_THRESHOLD=0.5
      
      # Noise reduction (disabled for faster dev)
      - NOISE_ENABLED=false
      
      # Silence compression
      - SILENCE_ENABLED=true
      - SILENCE_MAX_GAP_MS=600
      - SILENCE_KEEP_MS=150
      
      # Normalization
      - NORMALIZE_ENABLED=true
      - NORMALIZE_TARGET_DBFS=-20.0
      
      # Server
      - SERVER_HOST=0.0.0.0
      - SERVER_PORT=8080
      - SERVER_LOG_LEVEL=debug
      
      # App
      - APP_NAME=audio-preprocess-dev
      - ENVIRONMENT=development
      - DEBUG=true
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
    volumes:
      # Mount source for hot-reload during development
      - ./src:/app/src:ro
    restart: unless-stopped

networks:
  default:
    name: audio-preprocess-network
